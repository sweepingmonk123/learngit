[[Maintenance]]
=	运维中心
//文档整体配置
include::99_documentSetting.adoc[]

[[maint_cent_summary]]
== 运维中心概览

运维中心有以下四个模块：

* **运维概览**

运维概览主要是对任务运行情况的报表展示。

* **任务列表**

任务列表主要展示了您已经发布到调度系统的全部任务。

* **任务运维**

任务运维主要展示了任务提交到调度系统后，经过调度系统/补数据触发运行后生产实例的展示列表，主要有周期实例、补数据实例2个模块。

* **报警**

报警主要是对任务运行情况的监控，若被监控的任务未运行或运行失败，您将会收到提示信息，主要有监控记录和监控设置2个模块。

* **任务列表和任务运维的区别**

//断开

. 任务列表：存放的是发布到调度系统的任务
. 任务运维：存放的是所提交任务生成的实例

//断开

* **应用场景**

运维中心是对任务和实例展示/操作的地方。您可以在任务列表中看到您全部的任务，可以对展示的任务进行测试、补数据、添加报警等操作。在任务运维中，您可以看到您所有任务的实例，可以对展示的实例进行终止、重跑等操作。

[NOTE]
已发布的任务经过调度系统、手动触发运行后会生成一个或多个实例。实例代表了某个任务在某时某刻执行的一个快照，实例中会有任务的运行时间、运行状态、运行日志等信息。


[[maint_summary]]
== 运维概览

运维概览是进入运维中心后最先看到的页面，此页面将以图表的方式展示当前项目空间下实时任务、离线任务（周期性调度）的整体运行情况。

运维中心概览主要包括实时任务统计、离线任务统计、离线任务今日执行情况、离线任务执行时长排行和近一个月出错排行4个模块。

* **实时任务统计**

统计系统中不同状态的实时任务数量。

* **离线任务统计**

统计系统中不同状态的离线任务数量，离线任务的状态请参考本节后面的描述。

* **离线任务执行概览**

离线任务实例执行概览模块主要针对正常周期性调度今天、昨天与历史平均水平的任务完成情况进行对比统计，如果3条曲线偏移过多，则表示在某个时间段内有异常情况出现，需进行进一步的检查与分析。

[NOTE]
此处仅统计已完成状态的任务实例。

折线统计图以三种不同颜色折线显示对当天00:00~24:00时间段内，当前项目空间中所有类型任务完成进度的统计，包括今天的任务完成情况、昨天的任务完成情况和历史平均水平的完成情况。主要对实例执行的情况进行报表展示。

* **任务节点执行时长TOP10**

任务节点执行时长排行模块展示某一天中所有实例的执行时长排行，包括周期任务实例和补数据实例，同时也包括各种不同状态的任务实例，只展示TOP10。

支持选择某一天进行查看，选中的是实例的运行时间，不是业务日期。

[NOTE]
单击任务名，即可直接跳转到任务编辑页面。

* **近一个月出错TOP10**

近一个月出错排行模块展示近一个月的出错任务排行榜，只展示TOP10。

[NOTE]
单击任务名，即可直接跳转到任务编辑页面。

[[maint_batch]]
== 离线任务运维

离线任务的运维包括2大部分：任务管理、任务运维。任务管理模块中显示所有离线任务的信息，并可进行补数据操作。任务运维模块中显示所有离线任务实例的运行状态、可查看任务运行日志、查看任务上下游依赖关系，同时可以对任务状态进行切换。

[[maint_batch_jobmanage]]
=== 任务管理

* **周期任务列表**

点击**运维中心**左侧菜单中的**离线任务运维->任务管理**，可查看离线任务列表，包括任务名称、调度周期、任务类型、责任人、调度生效周期、具体调度时间、最近修改时间等信息。

[NOTE]
任务提交后，将会在第二天22:00自动生成实例来运行任务，若是在22:00以后提交的任务，则第三天才会开始生成实例来自动运行任务。

支持筛选条件过滤出要查询的任务。可根据任务名称、责任人、今日修改的任务、冻结状态、任务类型等条件精确筛选。

任务类型在筛选时分为5种，分别是SQL、MR、数据同步、Python、虚节点。

[NOTE]
任务名搜索的结果，会受到其他筛选条件的影响，只有同时满足所有筛选条件的结果才会展示出来。

**操作**：支持对任务进行补数据、修改等操作。

修改：点击**修改**按钮后，页面会进入此任务的编辑页面。

补数据：点击**补数据**按钮后，在弹窗中填写如下信息：

. 补数据名称；
. 业务日期：选择业务日期的开始日期、结束日期；
. 选定任务：在列出的各任务中选定需要进行补数据的任务；

点击“运行选中任务”后，系统会提示“补数据任务已在执行中，点击下方按钮查看结果”，点击后，可以在任务运维页面的“补数据”标签页内查看补数据任务的运行情况。

**批量操作**：支持批量选择任务，进行冻结、解冻操作。

[NOTE]
周期任务的冻结，是第二天生效的，且冻结状态的任务，生成的实例也是冻结状态，不会直接运行，必须将实例解冻后再单击重跑，才会运行；如果需要紧急冻结任务，可以在周期实例中进行冻结操作。

[NOTE]
冻结的任务生成的测试/补数据实例也会是冻结状态，只有解冻以后任务才会开始运行。


* **任务DAG图**

若想看某个任务的详细信息，可直接在任务列表中单击任务名，会从右侧弹出一个任务信息面板，包含任务的DAG图和运行报告。

在DAG图中可以选择具体任务的依赖关系和发布信息。

右键单击工作流/内部节点，可以选择补数据、查看代码、冻结、解冻、查看实例等操作。

* **运行报告**

运行报告中显示此任务在最近一段时间内的执行时长分析，支持切换最近7次、最近30次、最近60次。

如果是数据同步任务还会统计读取数据量和脏数据的产生情况，图表中同时列出执行时长、读取数据量、脏数据量3组数据，方便观察数据同步任务在近一段时间内的执行情况，评估此任务是否由于数据量过大造成执行时间越来越长？数据量不变，但执行时间突变，是否是由于代码进行了调整？很多任务都出现执行时间越来越长，是否是由于数据量变大？还是因为集群资源不够？

[NOTE]
统计图中的最近次数，其中包括了补数据的信息

[[maint_batch_jobstatus]]
=== 实例的状态转换

image::images\06_DTinsightIDEHelp_UserGuide_Maintenance-e5c45.png[]

如上图所示：从周期实例的产生到不同状态的转换链路比较长，且用户的**杀任务**、**冻结**等操作都会对任务实例的状态产生影响。

[[maint_batch_jobcycle]]
=== 周期实例

* **实例列表**

点击**运维中心**左侧菜单中的**离线任务->周期实例**，可查看离线任务实例列表，包括任务名称、调度周期、任务类型、业务日期、调度时间、任务实例创建时间、任务实例执行的开始时间、结束时间、运行时长、运行状态等信息。

任务实例列表还可以根据业务日期、责任人、任务名称、状态进行搜索和筛选。

* **实例DAG图**

若想看某个任务实例的详细信息，可直接在任务实例列表中单击任务名，会从右侧弹出一个实例信息面板，包含实例的DAG图。

在DAG图中可以选择具体任务实例的依赖关系和发布信息。

右键单击任务，可以选择展开上下游、查看日志、查看任务属性、终止、刷新任务实例、重跑并恢复调度、置成功并恢复调度、重跑下游并恢复调度等操作。

. 展开上游（6层）：点击后，直接展开选中任务的6层上游任务；
. 展开下游（6层）：类似“展开上游（6层）”；
. 查看任务日志：点击后，进入离线任务日志查看页面；
. 编辑任务：点击后，进入离线任务编辑页面；
. 查看任务属性：点击后，弹出任务属性弹窗，弹窗中包括任务名称、任务ID等属性信息；
. 终止：即手动杀任务的功能，点击后，本依赖关系图刷新任务状态；
. 刷新任务实例：点击后，刷新页面显示的所有任务实例，本依赖关系图刷新任务状态；
. 重跑并恢复调度：点击后，执行重跑，并恢复任务调度，本依赖关系图刷新任务状态；
. 置成功并恢复调度：点击后，强制将此设置为成功执行（状态为：手动设置成功），并恢复本任务的调度；
. 重跑下游并恢复调度：点击后，对下游任务进行重跑，并恢复任务调度，本依赖关系图刷新任务状态；

对于右键菜单中的6~9项操作，不同的任务状态可进行不同的操作：

[cols="1, 4", options="header"]]
|===
|任务状态  |可进行的操作
|未运行 |重跑任务
|运行中 |杀任务
|成功 |跑任务
|失败 |跑任务、置成功并恢复调度
|===

[NOTE]
周期任务的冻结，是第二天生效的，且冻结状态的任务，生成的实例也是冻结状态，不会直接运行，必须将实例解冻后再单击重跑，才会运行。

**批量操作**：支持批量选择任务，进行批量杀任务、重跑当前及下游任务操作。

[NOTE]
选中某个任务实例，点击“重跑当前及下游任务”时，是重跑您选择的任务实例，同时系统根据此任务的下游依赖关系，将下游任务实例一并重跑。


[NOTE]
“冻结”操作的状态不会作用于补数据实例

[[maint_batch_jobrerun]]
=== 补数据实例

周期任务进行补数据时产生的实例，即为补数据实例，可对已调度起的实例任务进行运维管理，如查看运行状态，对任务进行终止、重跑、解冻等操作。

由于补数据是对一批数据的多个业务日期执行操作，查看补数据实例需要有**2层**操作，第一层是补数据列表，每执行一次补数据就会产生一条记录；第二层是补数据实例列表，表示这次补数据中产生的每个实例的运行情况；

[NOTE]
如果是连续补好几天的补数据任务，已配置“自依赖”的任务，在第一天有一个任务实例失败了，那么第二天的任务实例也不会开始运行（只有当天的全部任务实例都成功，第二天的任务实例才会开始运行）。如果没有配置“自依赖”，则第二天的实例也会开始运行。

[NOTE]
自依赖的周期任务补数据，如果补数据第一个实例的前一个周期没有实例，也是能运行的。

[[maint_batch_jobrerun_list]]
==== 补数据列表

补数据列表即执行补数据的历史，支持根据业务日期运行日期、操作人等参数进行筛选。

**操作**：杀死所有实例，表示杀掉此次补数据中的所有实例，终止此次补数据的运行，当发现代码错误或其他异常希望停止补数据的运行时可以使用此功能。

[[maint_batch_jobrerun_joblist]]
==== 补数据实例列表

点击某个补数据列表后，进入详细的实例列表，补数据实例列表还可以根据业务日期、责任人、任务名称、状态进行搜索和筛选。

* **补数据实例DAG图**

若想看某个补数据实例的详细信息，可直接在实例列表中单击任务名，会从右侧弹出一个实例信息面板，包含实例的DAG图。

此处的操作与周期实例类似，不再赘述。

[NOTE]
“冻结”操作的状态不会作用于补数据实例

[[maint_stream]]
== 实时任务运维

实时任务运维模块中可查看实时任务实例的运行状态、查看任务运行日志，同时可以对任务状态进行切换。

不同于离线任务，在创建完实时任务后即可在**运维中心-实时任务运维**的列表中看到此任务，此时任务处于“未提交”状态。严格意义上说这里并不只是任务实例的列表，其中也包括了未提交的任务。

* **实时任务的状态转换**

image::images\06_DTinsightIDEHelp_UserGuide_Maintenance-7d38f.png[]

* **操作**

. 日志：点击**日志**链接，可查看本任务的日志信息。
. 提交：不同于离线任务，在创建完实时任务后即可在**运维中心-实时任务运维**的列表中看到此任务，此时任务处于“未提交”状态，需要用户点击**提交**按钮后，系统才会将此任务提交到后台执行。
. 停止：提交任务后，此任务会进入“等待运行”状态，并很快会进入到“运行中”状态（如果在这其中遇到异常情况，则会进入到“失败”状态），对于“等待运行”和“运行中”状态的任务，您可以点击**停止**，终止其运行，终止后任务进入“取消”状态。
. 续跑：任务将恢复至停止前的状态继续运行。续跑是基于Flink的checkpoint机制，DTinsightIDE将Flink的checkpoint信息记录在文件系统中，在您手动停止任务后继续保存这些信息，选择“续跑”后，任务将恢复至停止前的状态继续运行。
. 重跑：任务将丢弃停止前的状态，重新运行。

[[maint_alert]]
== 监控告警

告警监控模块中保存了DTinsightIDE产生的所有实时、离线任务告警信息，同时支持用户自定义告警规则，配置成功后，当监控的任务触发了告警规则后，DTinsightIDE将以邮件或短信的形式通知相关人员。

点击某项目上方的“运维中心”菜单，并在左侧的“告警监控”菜单下，可进入告警记录和自定义告警功能。

[[maint_alert_record]]
=== 告警记录

告警记录中包括了系统产生的所有任务告警信息，可在实时或离线标签页中查看两类任务产生的告警数量、任务名称、任务类型、责任人等信息。

可筛选时间、任务、告警接收人等信息筛选特定的告警。

[[maint_alert_config]]
=== 自定义配置

自定义告警可分别针对实时任务和离线任务配置不同的告警规则，可查看、修改已配置的规则，同时可对告警规则进行打开或关闭。

自定义告警模块依然按照实时任务和离线任务两个标签页展示，但二者操作方式类似，下面统一说明：

* **创建告警规则**
点击告警规则列表右上角的“创建告警规则”，在弹窗中完善如下信息：

. 告警规则名称；
. 任务名称；
. 告警触发点：
.. 实时任务只有“失败”一个触发点；
.. 离线任务可选择“任务失败”、“任务停止”、“定时未完成”、“超时未完成”中的一种。
... 任务失败、任务停止：任务出错失败或任务被用户手动杀掉时通知相关责任人。由于平台可能被多个用户使用，因此任务停止主要用于用户需要保障此任务不被其他用户停止时使用。
... 定时未完成：若对任务执行的时间长度有预期，可选择“定时未完成”，输入任务运行时长后，若此任务执行时长超过了设定值，DTinsightIDE会通知责任人。例如：业务上需要在每天早上9点将任务运行成功，则可以选择超时未完成，并设定为早上9:00，超过此时间时。
... 超时未完成：若对任务的启动时间、执行完成时间有预期，需要输入任务的运行时长，若此任务超过了这个时长未完成，DTinsightIDE会通知责任人。超时的时长是从任务的定时时间开始计算的。
. 告警方式：支持邮件、短信；
. 告警接收人：可选择此任务的责任人或项目组内的其他人员；


* **告警规则的开启、关闭**

开启某告警规则，表示DTinsightIDE会按照用户设定的规则产生并发送告警。

关闭某告警规则，通常用于暂时不想应用此告警规则，但也不想删除，以后可能再次开启的情况。

[NOTE]
补数据时：如果任务配置了任务失败、任务停止的告警，则会触发告警。

[NOTE]
补数据时：如果任务配置了超时未完成、定时未完成的告警，不会触发告警。

[NOTE]
任务停止：包括任务失败和用户手动杀任务,2种情况都会触发告警。
